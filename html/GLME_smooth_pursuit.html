
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Smooth pursuit in macular degeneration</title><meta name="generator" content="MATLAB 9.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2024-10-21"><meta name="DC.source" content="GLME_smooth_pursuit.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Smooth pursuit in macular degeneration</h1><!--introduction--><div><ul><li>This functions carries on the model statistical analysis for that project.</li><li>Eye movement data, visibility and d' have been preprocessed and gathered in the master datafile.</li><li>runs the GLM/GLME with the chopin toolbox.</li><li>plots various graphs</li><li>displays statistic conclusion messages</li><li>saves figures from statistical analysis in figures folder</li></ul></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Inputs</a></li><li><a href="#2">Outputs</a></li><li><a href="#4">Preprocessing</a></li><li><a href="#5">Primary hypotheses on d'</a></li><li><a href="#6">debugging</a></li></ul></div><h2 id="1">Inputs</h2><p>None. The function must run from the analysis folder with the master datafile being located in data. Functions used in this code should all be located in shared_codes.</p><h2 id="2">Outputs</h2><p>None. But generates figures (folder figures), statistics (command window) and generates a joint markdown output in html by pressing Publish.</p><pre class="codeinput"><span class="keyword">function</span> GLME_smooth_pursuit
<span class="keyword">try</span>
</pre><pre class="codeinput"> close <span class="string">all</span>;
 clc;
</pre><h2 id="4">Preprocessing</h2><p>Creates the correct path structure</p><pre class="codeinput">analysis_path = fileparts(mfilename(<span class="string">'fullpath'</span>)); <span class="comment">% root path</span>
addpath(genpath(fullfile(analysis_path,<span class="string">'shared_codes'</span>))) <span class="comment">% path with necessary codes</span>
data_path = fullfile(analysis_path,<span class="string">'data'</span>); <span class="comment">% path with the masterfile with data for analysis</span>
figure_path = fullfile(analysis_path,<span class="string">'figures'</span>);  <span class="comment">% path for saving the figures</span>

<span class="comment">% Reads data files</span>
file = <span class="string">'data_smooth_pursuit_MD.xlsx'</span>;
data = readtable(fullfile(data_path,file),<span class="string">'Sheet'</span>,<span class="string">'data'</span>); <span class="comment">% read file</span>
dispi(<span class="string">'Loaded file '</span>,file);

<span class="comment">% Normalize variable formats</span>
data.subject_ID = categorical(data.subject_ID);
data.status = categorical(data.status);
data = clean_names(data);

<span class="comment">% show a sample of the data</span>
disp(<span class="string">'Data sample and size:'</span>)
disp(data(1:10,:))
dispi(size(data,1),<span class="string">' lines of data found.'</span>)
</pre><pre class="codeoutput">Loaded file data_smooth_pursuit_MD.xlsx
Data sample and size:
    subjectID    conditionCode      eyesTested      status       scotoma        condition       direction      dprime     fractionOccluded    eccentricity      ocm  
    _________    _____________    ______________    _______    ____________    ___________    _____________    _______    ________________    ____________    _______

       C1           {'C1'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'leftward' }     2.1383           0               1.2551       0.34046
       C2           {'C2'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'leftward' }     1.5695           0              0.61054       0.22687
       C3           {'C3'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'leftward' }    0.65321           0               1.4787       0.98788
       C4           {'C4'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'leftward' }      1.722           0              0.68591        0.2778
       C1           {'C1'}        {'No_Scotoma'}    control    {'controls'}    {'fix'    }    {'rightward'}     1.8346           0               2.5405       0.69374
       C2           {'C2'}        {'No_Scotoma'}    control    {'controls'}    {'fix'    }    {'rightward'}     1.1052           0               1.9286       0.58416
       C3           {'C3'}        {'No_Scotoma'}    control    {'controls'}    {'fix'    }    {'rightward'}    0.97069           0               2.8653       0.84289
       C1           {'C1'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'rightward'}     2.4848           0               1.3806       0.23138
       C3           {'C3'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'rightward'}     1.0931           0              0.87279       0.32138
       C2           {'C2'}        {'No_Scotoma'}    control    {'controls'}    {'pursuit'}    {'rightward'}     1.5457           0              0.59828       0.43492

116 lines of data found.
</pre><h2 id="5">Primary hypotheses on d'</h2><p>Explore how the data can be explained by oculomotor noise, fraction occluded and eccentricity Hypotheses: * more eccentric stimuli result in worse d' * more fraction occluded for the stimuli result in worse d' * more oculomotor noise result in worse d'</p><pre class="codeinput"><span class="comment">% explore which distribution is correct</span>
check_distrib_indep(data.dprime(data.status==<span class="string">'control'</span>),data.dprime(data.status==<span class="string">'patient'</span>),<span class="string">'d'''</span>);
disp(<span class="string">'Data are not distributed differently than normal'</span>)
saveas(gcf,fullfile(figure_path,<span class="string">'dprime_distribution.fig'</span>)); snapnow;
<span class="comment">% Only apply the collinearity analysis on continuous predictors</span>
<span class="comment">% Use Kendall correlations that are more powerful when using small samples</span>
corrplot2(data(:,{<span class="string">'eccentricity'</span>,<span class="string">'fractionOccluded'</span>,<span class="string">'ocm'</span>}),<span class="string">'type'</span>,<span class="string">'Kendall'</span>)
disp(<span class="string">'No particular worries for collinearity but keep in mind the correlation between ecc and ocm.'</span>)
saveas(gcf,fullfile(figure_path,<span class="string">'factor_collinearity.fig'</span>)); snapnow;

<span class="comment">% define a model structure</span>
<span class="comment">% a table with the data, here called data</span>
model.data = data;
<span class="comment">% the name of the dependent variable in the data structure, here it is data.initial_work_mem</span>
model.dv = <span class="string">'dprime'</span>;
<span class="comment">% its distribution among poisson, normal, gamma, inverse gaussian, binomial as previously determined</span>
model.distribution = <span class="string">'normal'</span>;
<span class="comment">% the maximal nb of factors to explore in the model</span>
model.max_nb_factors = 4; <span class="comment">% n=10 so 100 data are used to estimate subjects' random effects (1 factor). 16 data can be used to estimate 2 more factors - we add 1 so that we can also look at the effect of non-significant factors.</span>
model.solid_factors = {<span class="string">'(1|subjectID)'</span>}; <span class="comment">%keep these between {}</span>
<span class="comment">% a list of possible factors to be included, that can be removed if needed, and the interactions terms to explore</span>
model.liquid_factors = {<span class="string">'eccentricity'</span>,<span class="string">'ocm'</span>,<span class="string">'fractionOccluded'</span>,<span class="string">'fractionOccluded:ocm'</span>,<span class="string">'eccentricity:ocm'</span>,<span class="string">'fractionOccluded:eccentricity'</span>}; <span class="comment">%keep these between {}</span>
<span class="comment">% a list of potential model links</span>
model.links = {<span class="string">'identity'</span>};
<span class="comment">% outliers/subjects to be removed - can be left empty</span>
model.exclude = [98,107,110]; <span class="comment">% exclude the 3 instances for which participants did not follow pursuit instructions</span>
<span class="comment">% no warnings if 1 - careful with that option</span>
model.warning_off = 0;
<span class="comment">% whether to use a GLM (0) or a GLME (1).</span>
model.glme = 1;

<span class="comment">% run the model</span>
mdls = all_glm(model);

<span class="comment">% display diagnostics and results</span>
display_model(mdls{1}, model) <span class="comment">%plot model ranked 1 - you can select any other models by rank according to the results on the various indicators provided</span>
saveas(gcf,fullfile(figure_path,<span class="string">'dprime_GLME_diagnostics.fig'</span>)); snapnow;
h=subplot(1,3,1);       plot_covariate_effect(data.dprime, data.fractionOccluded.*100, h, <span class="string">'fraction occluded (%)'</span>, <span class="string">'d prime'</span>, 0, 0, mdls{1},1,model);
h=subplot(1,3,2);       plot_covariate_effect(data.dprime, data.eccentricity, h, <span class="string">'eccentricity (deg)'</span>, <span class="string">'d prime'</span>, 0, 0, mdls{1},1,model);
h=subplot(1,3,3); plot_interaction(data.dprime, (data.eccentricity&lt;=median(data.eccentricity)),data.fractionOccluded.*100, h, <span class="string">'fraction occluded (%)'</span>,<span class="string">'d prime'</span>, {<span class="string">'eccentricity &gt; median'</span>,<span class="string">'eccentricity &lt;= median'</span>},mdls{1}, 1, model); <span class="comment">% median is 2.36</span>
disp(<span class="string">'The first model is undeniably the best fit for the data with best AIC but also best adj. R2 and best R2.'</span>)
disp(<span class="string">'Interpretation: there is mostly a medium effect of fraction occluded. There is also a small effect of eccentricity and a small interaction effect between them.'</span>)
disp(<span class="string">'Larger eccentricities and fraction occluded are associated with worse d'' results, but for higher fraction occluded, eccentricity effects decrease.'</span>)
disp(<span class="string">'In lay terms, when it is occluded, it does not matter that it is blurry.'</span>)
disp(<span class="string">'When running model #3 to see the effect of oculo-motor noise, its effect is small and non-significant.'</span>)
saveas(gcf,fullfile(figure_path,<span class="string">'dprime_GLME_effects.fig'</span>)); snapnow;
</pre><pre class="codeoutput">d' - Wilcoxon-Mann&#8211;Whitney (signed-ranks) U = 5694, p = 0.0130
Data are significantly different, so let's keep them separated
Kolmogorov-Smirnov tests for normality:  Group 1 - KS = 0.10, p = 0.3028 and Group 2 - KS = 0.18, p = 0.3323
Data are not distributed differently than normal
</pre><img vspace="5" hspace="5" src="GLME_smooth_pursuit_01.png" alt=""> <pre class="codeoutput">No particular worries for collinearity but keep in mind the correlation between ecc and ocm.
</pre><img vspace="5" hspace="5" src="GLME_smooth_pursuit_02.png" alt=""> <pre class="codeoutput">Running 41 GLMEs...
We tested 41 models.
    Rank                                                     formula                                                         link         AIC      adj.R2(%)    R2(%)    norm.res.
    ____    _________________________________________________________________________________________________________    ____________    ______    _________    _____    _________

      1     {'dprime ~ 1  + eccentricity + fractionOccluded + fractionOccluded:eccentricity + (1|subjectID)'        }    {'identity'}    197.13      32.2         34      {'yes'} 
      2     {'dprime ~ 1  + eccentricity + fractionOccluded + (1|subjectID)'                                        }    {'identity'}    199.03      29.9       31.2      {'yes'} 
      3     {'dprime ~ 1  + ocm + fractionOccluded + (1|subjectID)'                                                 }    {'identity'}    199.93      29.7         31      {'yes'} 
      4     {'dprime ~ 1  + ocm + fractionOccluded + fractionOccluded:ocm + (1|subjectID)'                          }    {'identity'}    200.37      30.6       32.5      {'yes'} 
      5     {'dprime ~ 1  + eccentricity + fractionOccluded + eccentricity:ocm + (1|subjectID)'                     }    {'identity'}    200.62      29.8       31.7      {'yes'} 
      6     {'dprime ~ 1  + eccentricity + ocm + fractionOccluded + (1|subjectID)'                                  }    {'identity'}    200.65      29.3       31.2      {'yes'} 
      7     {'dprime ~ 1  + eccentricity + fractionOccluded + fractionOccluded:ocm + (1|subjectID)'                 }    {'identity'}    200.72      29.8       31.7      {'yes'} 
      8     {'dprime ~ 1  + ocm + fractionOccluded + fractionOccluded:eccentricity + (1|subjectID)'                 }    {'identity'}    200.88      30.5       32.4      {'yes'} 
      9     {'dprime ~ 1  + fractionOccluded + (1|subjectID)'                                                       }    {'identity'}    201.11      29.3       29.9      {'yes'} 
     10     {'dprime ~ 1  + ocm + fractionOccluded + eccentricity:ocm + (1|subjectID)'                              }    {'identity'}     201.3      29.8       31.7      {'yes'} 
     11     {'dprime ~ 1  + fractionOccluded + eccentricity:ocm + (1|subjectID)'                                    }    {'identity'}    201.59      28.8       30.1      {'yes'} 
     12     {'dprime ~ 1  + fractionOccluded + eccentricity:ocm + fractionOccluded:eccentricity + (1|subjectID)'    }    {'identity'}    202.65      29.4       31.3      {'yes'} 
     13     {'dprime ~ 1  + fractionOccluded + fractionOccluded:eccentricity + (1|subjectID)'                       }    {'identity'}    202.89      29.1       30.4      {'yes'} 
     14     {'dprime ~ 1  + fractionOccluded + fractionOccluded:ocm + (1|subjectID)'                                }    {'identity'}       203      28.5       29.8      {'yes'} 
     15     {'dprime ~ 1  + fractionOccluded + fractionOccluded:ocm + eccentricity:ocm + (1|subjectID)'             }    {'identity'}    203.42      28.4       30.4      {'yes'} 
     16     {'dprime ~ 1  + fractionOccluded + fractionOccluded:ocm + fractionOccluded:eccentricity + (1|subjectID)'}    {'identity'}    204.48      28.6       30.5      {'yes'} 
     17     {'dprime ~ 1  + fractionOccluded:ocm + (1|subjectID)'                                                   }    {'identity'}    208.85        21       21.7      {'yes'} 
     18     {'dprime ~ 1  + eccentricity + fractionOccluded:ocm + eccentricity:ocm + (1|subjectID)'                 }    {'identity'}    209.57      21.5       23.6      {'yes'} 
     19     {'dprime ~ 1  + eccentricity + fractionOccluded:ocm + (1|subjectID)'                                    }    {'identity'}    209.68        20       21.4      {'yes'} 
     20     {'dprime ~ 1  + fractionOccluded:ocm + fractionOccluded:eccentricity + (1|subjectID)'                   }    {'identity'}    210.81      20.4       21.8      {'yes'} 
     21     {'dprime ~ 1  + fractionOccluded:ocm + eccentricity:ocm + (1|subjectID)'                                }    {'identity'}    210.83      20.4       21.9      {'yes'} 
     22     {'dprime ~ 1  + ocm + fractionOccluded:ocm + (1|subjectID)'                                             }    {'identity'}    210.85      20.2       21.7      {'yes'} 
     23     {'dprime ~ 1  + eccentricity + fractionOccluded:ocm + fractionOccluded:eccentricity + (1|subjectID)'    }    {'identity'}    211.19      19.5       21.6      {'yes'} 
     24     {'dprime ~ 1  + eccentricity + ocm + fractionOccluded:ocm + (1|subjectID)'                              }    {'identity'}    211.19      19.9       22.1      {'yes'} 
     25     {'dprime ~ 1  + ocm + fractionOccluded:ocm + eccentricity:ocm + (1|subjectID)'                          }    {'identity'}     212.7      19.8         22      {'yes'} 
     26     {'dprime ~ 1  + fractionOccluded:ocm + eccentricity:ocm + fractionOccluded:eccentricity + (1|subjectID)'}    {'identity'}    212.79      19.8         22      {'yes'} 
     27     {'dprime ~ 1  + ocm + fractionOccluded:ocm + fractionOccluded:eccentricity + (1|subjectID)'             }    {'identity'}    212.81      19.7       21.8      {'yes'} 
     28     {'dprime ~ 1  + fractionOccluded:eccentricity + (1|subjectID)'                                          }    {'identity'}    218.26      13.3       14.1      {'yes'} 
     29     {'dprime ~ 1  + ocm + fractionOccluded:eccentricity + (1|subjectID)'                                    }    {'identity'}    218.63      12.8       14.4      {'yes'} 
     30     {'dprime ~ 1  + ocm + eccentricity:ocm + fractionOccluded:eccentricity + (1|subjectID)'                 }    {'identity'}    219.01      13.8       16.2      {'yes'} 
     31     {'dprime ~ 1  + eccentricity + fractionOccluded:eccentricity + (1|subjectID)'                           }    {'identity'}    219.64      12.4         14      {'yes'} 
     32     {'dprime ~ 1  + eccentricity:ocm + fractionOccluded:eccentricity + (1|subjectID)'                       }    {'identity'}       220      12.3       13.9      {'yes'} 
     33     {'dprime ~ 1  + eccentricity + ocm + fractionOccluded:eccentricity + (1|subjectID)'                     }    {'identity'}    220.63        12       14.4      {'yes'} 
     34     {'dprime ~ 1  + eccentricity + eccentricity:ocm + fractionOccluded:eccentricity + (1|subjectID)'        }    {'identity'}    221.62      11.7       14.1      {'yes'} 
     35     {'dprime ~ 1  + eccentricity + ocm + eccentricity:ocm + (1|subjectID)'                                  }    {'identity'}    223.43      10.6         13      {'yes'} 
     36     {'dprime ~ 1  + eccentricity + (1|subjectID)'                                                           }    {'identity'}    223.46       8.8        9.6      {'yes'} 
     37     {'dprime ~ 1  + ocm + (1|subjectID)'                                                                    }    {'identity'}    224.44       8.8        9.6      {'yes'} 
     38     {'dprime ~ 1  + eccentricity + ocm + (1|subjectID)'                                                     }    {'identity'}    224.92       8.2        9.8      {'yes'} 
     39     {'dprime ~ 1  + eccentricity + eccentricity:ocm + (1|subjectID)'                                        }    {'identity'}    225.24       8.4       10.1      {'yes'} 
     40     {'dprime ~ 1  + ocm + eccentricity:ocm + (1|subjectID)'                                                 }    {'identity'}    225.89       8.9       10.6      {'yes'} 
     41     {'dprime ~ 1  + eccentricity:ocm + (1|subjectID)'                                                       }    {'identity'}     226.1       7.5        8.3      {'yes'} 

 ------------------------------------------------------------------------------- 
Summary of variable formats in best model
                             Class                                    Range                                InModel    IsCategorical
                        _______________    ____________________________________________________________    _______    _____________

    subjectID           {'categorical'}    {[C1    C2    C3    C4    M1    M2    M3    M4    M5    M6]}     true          true     
    fractionOccluded    {'double'     }    {[                                                0 0.9179]}     true          false    
    eccentricity        {'double'     }    {[                                          0.3935 14.4538]}     true          false    

Summary of best model

Generalized linear mixed-effects model fit by PL

Model information:
    Number of observations             112
    Fixed effects coefficients           4
    Random effects coefficients         10
    Covariance parameters                2
    Distribution                    Normal
    Link                            Identity
    FitMethod                       MPL   

Formula:
    dprime ~ 1 + fractionOccluded*eccentricity + (1 | subjectID)

Model fit statistics:
    AIC       BIC       LogLikelihood    Deviance
    197.13    213.44    -92.567          185.13  

Fixed effects coefficients (95% CIs):
    Name                                     Estimate    SE          tStat  
    {'(Intercept)'                  }          1.4432     0.14843      9.723
    {'fractionOccluded'             }         -1.4507     0.27205    -5.3326
    {'eccentricity'                 }        -0.08268    0.028431    -2.9081
    {'fractionOccluded:eccentricity'}         0.15457    0.077455     1.9957


    DF     pValue        Lower       Upper    
    108    1.9909e-16       1.149       1.7374
    108    5.3637e-07       -1.99     -0.91149
    108      0.004415    -0.13904    -0.026324
    108      0.048488    0.001045       0.3081

Random effects covariance parameters:
Group: subjectID (10 Levels)
    Name1                  Name2                  Type           Estimate
    {'(Intercept)'}        {'(Intercept)'}        {'std'}        0.22696 

Group: Error
    Name                        Estimate
    {'sqrt(Dispersion)'}        0.53035 

AIC: 197.1333
Adjusted R^2: 32.2%
R^2: 34%
Residuals: Kolmogorov test for normality (alpha 5%):  KS = 0.11, p = 0.1496
Residuals are normal

    RANDOM EFFECT COEFFICIENTS: DFMETHOD = 'RESIDUAL', ALPHA = 0.01

    Group                Level         Name                   Estimate 
    {'subjectID'}        {'C1'}        {'(Intercept)'}          0.27258
    {'subjectID'}        {'C2'}        {'(Intercept)'}          0.16035
    {'subjectID'}        {'C3'}        {'(Intercept)'}          0.11513
    {'subjectID'}        {'C4'}        {'(Intercept)'}         -0.32463
    {'subjectID'}        {'M1'}        {'(Intercept)'}         -0.11601
    {'subjectID'}        {'M2'}        {'(Intercept)'}         0.010563
    {'subjectID'}        {'M3'}        {'(Intercept)'}         -0.18948
    {'subjectID'}        {'M4'}        {'(Intercept)'}        -0.063841
    {'subjectID'}        {'M5'}        {'(Intercept)'}         0.076552
    {'subjectID'}        {'M6'}        {'(Intercept)'}         0.058782


    SEPred     tStat       DF     pValue      Lower        Upper   
    0.12986       2.099    108    0.038145    -0.067929     0.61309
    0.12886      1.2444    108     0.21605     -0.17753     0.49822
    0.13729     0.83857    108     0.40356     -0.24486     0.47512
    0.14043     -2.3117    108    0.022693     -0.69285    0.043596
    0.18689    -0.62073    108     0.53609     -0.60607     0.37405
    0.18584    0.056841    108     0.95478     -0.47673     0.49786
    0.18574     -1.0201    108     0.30996     -0.67651     0.29756
    0.18935    -0.33716    108     0.73665     -0.56033     0.43265
    0.19298     0.39669    108     0.69238     -0.42946     0.58257
    0.16871     0.34843    108      0.7282     -0.38359     0.50115

No adjustment for multiple comparisons
                  Name                   Estimate     tStat     DF       pValue      adj_pValue    H0_reject
    _________________________________    ________    _______    ___    __________    __________    _________

    {'fractionOccluded'             }     -1.4507    -5.3326    108    5.3637e-07    5.3637e-07      true   
    {'eccentricity'                 }    -0.08268    -2.9081    108      0.004415      0.004415      true   
    {'fractionOccluded:eccentricity'}     0.15457     1.9957    108      0.048488      0.048488      true   

Significant effect of fractionOccluded (t(108) = -5.33, adjusted p = 0)
Significant effect of eccentricity (t(108) = -2.91, adjusted p = 0.0044)
Significant effect of fractionOccluded:eccentricity (t(108) = 2, adjusted p = 0.0485)
Local effect size for fractionOccluded : Cohen s f2 = 0.3 (medium)
Local effect size for eccentricity : Cohen s f2 = 0.05 (small)
Local effect size for fractionOccluded:eccentricity : Cohen s f2 = 0.06 (small)
 ------------------------------------------------------------------------------- 

ans =

  3&times;7 table

                      Name                       Estimate     tStat     DF       pValue      adj_pValue    H0_reject
    _________________________________________    ________    _______    ___    __________    __________    _________

    {'dprime: fractionOccluded'             }     -1.4507    -5.3326    108    5.3637e-07    5.3637e-07      true   
    {'dprime: eccentricity'                 }    -0.08268    -2.9081    108      0.004415      0.004415      true   
    {'dprime: fractionOccluded:eccentricity'}     0.15457     1.9957    108      0.048488      0.048488      true   

</pre><img vspace="5" hspace="5" src="GLME_smooth_pursuit_03.png" alt=""> <pre class="codeoutput">The first model is undeniably the best fit for the data with best AIC but also best adj. R2 and best R2.
Interpretation: there is mostly a medium effect of fraction occluded. There is also a small effect of eccentricity and a small interaction effect between them.
Larger eccentricities and fraction occluded are associated with worse d' results, but for higher fraction occluded, eccentricity effects decrease.
In lay terms, when it is occluded, it does not matter that it is blurry.
When running model #3 to see the effect of oculo-motor noise, its effect is small and non-significant.
</pre><img vspace="5" hspace="5" src="GLME_smooth_pursuit_04.png" alt=""> <h2 id="6">debugging</h2><pre class="codeinput"><span class="keyword">catch</span> err
   keyboard
<span class="keyword">end</span>
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Smooth pursuit in macular degeneration
% * This functions carries on the model statistical analysis for that project.
% * Eye movement data, visibility and d' have been preprocessed and gathered in the master datafile.
% * runs the GLM/GLME with the chopin toolbox.
% * plots various graphs
% * displays statistic conclusion messages
% * saves figures from statistical analysis in figures folder

%% Inputs
% None. The function must run from the analysis folder with the master datafile being located in data. 
% Functions used in this code should all be located in shared_codes.

%% Outputs
% None. But generates figures (folder figures), statistics (command window) and generates a joint markdown output in html 
% by pressing Publish.

function GLME_smooth_pursuit
try
 close all;
 clc;
%% Preprocessing
% Creates the correct path structure
analysis_path = fileparts(mfilename('fullpath')); % root path
addpath(genpath(fullfile(analysis_path,'shared_codes'))) % path with necessary codes
data_path = fullfile(analysis_path,'data'); % path with the masterfile with data for analysis
figure_path = fullfile(analysis_path,'figures');  % path for saving the figures

% Reads data files
file = 'data_smooth_pursuit_MD.xlsx';
data = readtable(fullfile(data_path,file),'Sheet','data'); % read file
dispi('Loaded file ',file);

% Normalize variable formats
data.subject_ID = categorical(data.subject_ID);
data.status = categorical(data.status);
data = clean_names(data);

% show a sample of the data
disp('Data sample and size:')
disp(data(1:10,:))
dispi(size(data,1),' lines of data found.')

%% Primary hypotheses on d'
% Explore how the data can be explained by oculomotor noise, fraction occluded and eccentricity
% Hypotheses: 
% * more eccentric stimuli result in worse d'
% * more fraction occluded for the stimuli result in worse d'
% * more oculomotor noise result in worse d'

% explore which distribution is correct
check_distrib_indep(data.dprime(data.status=='control'),data.dprime(data.status=='patient'),'d''');
disp('Data are not distributed differently than normal')
saveas(gcf,fullfile(figure_path,'dprime_distribution.fig')); snapnow;
% Only apply the collinearity analysis on continuous predictors
% Use Kendall correlations that are more powerful when using small samples
corrplot2(data(:,{'eccentricity','fractionOccluded','ocm'}),'type','Kendall')
disp('No particular worries for collinearity but keep in mind the correlation between ecc and ocm.')
saveas(gcf,fullfile(figure_path,'factor_collinearity.fig')); snapnow;

% define a model structure
% a table with the data, here called data
model.data = data;
% the name of the dependent variable in the data structure, here it is data.initial_work_mem
model.dv = 'dprime';
% its distribution among poisson, normal, gamma, inverse gaussian, binomial as previously determined
model.distribution = 'normal';
% the maximal nb of factors to explore in the model
model.max_nb_factors = 4; % n=10 so 100 data are used to estimate subjects' random effects (1 factor). 16 data can be used to estimate 2 more factors - we add 1 so that we can also look at the effect of non-significant factors.
model.solid_factors = {'(1|subjectID)'}; %keep these between {}
% a list of possible factors to be included, that can be removed if needed, and the interactions terms to explore
model.liquid_factors = {'eccentricity','ocm','fractionOccluded','fractionOccluded:ocm','eccentricity:ocm','fractionOccluded:eccentricity'}; %keep these between {}
% a list of potential model links
model.links = {'identity'};
% outliers/subjects to be removed - can be left empty
model.exclude = [98,107,110]; % exclude the 3 instances for which participants did not follow pursuit instructions
% no warnings if 1 - careful with that option
model.warning_off = 0;
% whether to use a GLM (0) or a GLME (1).
model.glme = 1;

% run the model
mdls = all_glm(model);

% display diagnostics and results
display_model(mdls{1}, model) %plot model ranked 1 - you can select any other models by rank according to the results on the various indicators provided
saveas(gcf,fullfile(figure_path,'dprime_GLME_diagnostics.fig')); snapnow;
h=subplot(1,3,1);       plot_covariate_effect(data.dprime, data.fractionOccluded.*100, h, 'fraction occluded (%)', 'd prime', 0, 0, mdls{1},1,model);
h=subplot(1,3,2);       plot_covariate_effect(data.dprime, data.eccentricity, h, 'eccentricity (deg)', 'd prime', 0, 0, mdls{1},1,model);
h=subplot(1,3,3); plot_interaction(data.dprime, (data.eccentricity<=median(data.eccentricity)),data.fractionOccluded.*100, h, 'fraction occluded (%)','d prime', {'eccentricity > median','eccentricity <= median'},mdls{1}, 1, model); % median is 2.36
disp('The first model is undeniably the best fit for the data with best AIC but also best adj. R2 and best R2.')
disp('Interpretation: there is mostly a medium effect of fraction occluded. There is also a small effect of eccentricity and a small interaction effect between them.')
disp('Larger eccentricities and fraction occluded are associated with worse d'' results, but for higher fraction occluded, eccentricity effects decrease.')
disp('In lay terms, when it is occluded, it does not matter that it is blurry.')
disp('When running model #3 to see the effect of oculo-motor noise, its effect is small and non-significant.')
saveas(gcf,fullfile(figure_path,'dprime_GLME_effects.fig')); snapnow;

%% debugging
catch err
   keyboard 
end
end


##### SOURCE END #####
--></body></html>